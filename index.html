<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="app-title-tag">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ö‡¶ü‡¶ø ‡¶ó‡¶≤‡ßç‡¶™</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src='//libtl.com/sdk.js' data-zone='10366901' data-sdk='show_10366901'></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Hind Siliguri', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            transition: background-color 0.3s, color 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        /* Night Mode Styles */
        body.night-mode {
            background-color: #0f172a;
            color: #e2e8f0;
        }

        .night-mode .bg-white { background-color: #1e293b; }
        .night-mode .text-gray-800 { color: #f1f5f9; }
        .night-mode .text-gray-900 { color: #ffffff; }
        .night-mode .text-gray-500 { color: #94a3b8; }
        .night-mode .border-gray-100 { border-color: #334155; }
        .night-mode .bg-gray-50 { background-color: #334155; }
        .night-mode .hover\:bg-gray-50:hover { background-color: #475569; }
        .night-mode input, .night-mode textarea, .night-mode select {
            background-color: #334155;
            color: white;
            border-color: #475569;
        }

        .hidden { display: none !important; }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        .page-btn {
            width: 35px; height: 35px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 8px; font-weight: bold; font-size: 14px;
            cursor: pointer; transition: all 0.2s;
        }
        .page-btn.active { background-color: #2563eb; color: white; border: none; }
        .page-btn.inactive { background-color: white; border: 1px solid #e2e8f0; color: #1e293b; }
        .night-mode .page-btn.inactive { background-color: #1e293b; border-color: #334155; color: #e2e8f0; }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>

    <div id="loading-screen" class="fixed inset-0 z-50 bg-white flex flex-col items-center justify-center">
        <div class="loader mb-4"></div>
        <p class="text-gray-500 animate-pulse">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <div id="age-gate" class="hidden fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-5 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-2xl max-w-sm text-center shadow-2xl">
            <h2 class="text-2xl font-bold text-red-600 mb-4">‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡ßÄ‡¶ï‡¶∞‡¶£ (18+)</h2>
            <p class="text-gray-600 mb-6">‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∑‡ßü‡¶¨‡¶∏‡ßç‡¶§‡ßÅ ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§‡¶¨‡ßü‡¶∏‡ßç‡¶ï‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßü‡¶∏ ‡¶ï‡¶ø ‡ßß‡ßÆ ‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø?</p>
            <button onclick="acceptAgeGate()" class="bg-red-600 text-white px-8 py-3 rounded-full font-bold w-full hover:bg-red-700 transition">‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶Ü‡¶Æ‡¶ø ‡ßß‡ßÆ+</button>
        </div>
    </div>

    <div id="auth-modal" class="hidden fixed inset-0 z-40 bg-black/70 flex items-center justify-center p-5 backdrop-blur-sm">
        <div class="bg-white p-6 rounded-2xl w-full max-w-sm relative shadow-xl">
            <h3 id="auth-title" class="text-xl font-bold mb-2 text-center text-gray-800">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <p id="auth-subtitle" class="text-center text-sm text-gray-500 mb-6">‡¶ó‡¶≤‡ßç‡¶™ ‡¶™‡ßú‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            
            <form onsubmit="handleAuth(event)" class="space-y-4">
                <input type="email" id="auth-email" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤" required class="w-full p-3 border rounded-lg bg-gray-50 focus:outline-none focus:border-blue-500 text-gray-800">
                <input type="password" id="auth-pass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°" required class="w-full p-3 border rounded-lg bg-gray-50 focus:outline-none focus:border-blue-500 text-gray-800">
                <button type="submit" id="auth-submit-btn" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition">‡¶≤‡¶ó‡¶á‡¶®</button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-gray-600 text-sm">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? 
                    <button onclick="toggleAuthMode()" id="auth-toggle-link" class="text-blue-600 font-bold">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</button>
                </p>
            </div>
        </div>
    </div>

    <div id="home-screen">
        <header class="sticky top-0 z-30 bg-white/90 backdrop-blur border-b border-gray-100 px-4 py-3 flex justify-between items-center">
            <h1 id="app-nav-title" class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-purple-600 cursor-pointer" onclick="window.location.reload()">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ö‡¶ü‡¶ø ‡¶ó‡¶≤‡ßç‡¶™</h1>
            <div class="flex items-center gap-3">
                <button onclick="toggleNightMode()" class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition">üåô</button>
                <button onclick="auth.signOut()" class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition">üö™</button>
            </div>
        </header>

        <div class="p-4 space-y-4">
            <button onclick="window.open('https://t.me/banglachotigolpoBCG', '_blank')" class="w-full bg-[#0088cc] text-white py-3 rounded-xl font-bold shadow-md hover:bg-[#0077b5] transition flex items-center justify-center gap-2">
                ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>

            <input type="text" id="search-input" onkeyup="handleSearch()" placeholder="‡¶ó‡¶≤‡ßç‡¶™ ‡¶¨‡¶æ ‡¶≤‡ßá‡¶ñ‡¶ï ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="w-full p-3 rounded-xl border border-gray-200 bg-white shadow-sm focus:outline-none focus:border-blue-500 text-gray-800 transition">

            <div id="category-filters" class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide"></div>
        </div>

        <div id="stories-list" class="px-4 space-y-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>

        <div id="no-data-msg" class="hidden text-center py-20 text-gray-400">
            <p class="text-4xl mb-2">üòû</p>
            <p>‡¶ï‡ßã‡¶®‡ßã ‡¶ó‡¶≤‡ßç‡¶™ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>
        </div>

        <div id="pagination-container" class="py-8 flex justify-center items-center gap-2 flex-wrap px-4 pb-20"></div>

        <button id="admin-indicator" onclick="showScreen('admin-panel'); renderAdminListUI();" class="hidden fixed bottom-6 right-6 bg-purple-600 text-white p-4 rounded-full shadow-lg font-bold z-30 hover:scale-105 transition">
            ‚öôÔ∏è ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤
        </button>
    </div>

    <div id="reading-screen" class="hidden min-h-screen bg-white pb-20">
        <div class="sticky top-0 bg-white/95 backdrop-blur border-b p-3 flex justify-between items-center z-10 shadow-sm">
            <button onclick="closeReadingScreen()" class="text-blue-600 font-bold px-2 py-1 flex items-center gap-1 hover:bg-blue-50 rounded">
                <span>‚Üê</span> ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
            </button>
            <div class="flex items-center gap-2">
                <button id="read-fav-btn" onclick="toggleReadScreenFavorite()" class="p-2 text-xl border rounded bg-gray-50 hover:bg-gray-100 transition mr-2">ü§ç</button>
                <button onclick="changeFontSize('decrease')" class="bg-gray-100 border px-3 py-1 rounded text-sm font-bold active:bg-gray-200 text-black">A-</button>
                <button onclick="changeFontSize('increase')" class="bg-gray-100 border px-3 py-1 rounded text-sm font-bold active:bg-gray-200 text-black">A+</button>
            </div>
        </div>

        <div class="p-5 max-w-3xl mx-auto">
            <h1 id="read-title" class="text-2xl md:text-3xl font-bold mb-3 text-gray-900 leading-snug">‡¶ó‡¶≤‡ßç‡¶™‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</h1>
            <div class="flex flex-wrap justify-between items-center text-sm text-gray-500 mb-6 border-b pb-4 gap-2">
                <div class="flex gap-3">
                    <span id="read-meta-author" class="bg-blue-50 text-blue-600 px-2 py-0.5 rounded border border-blue-100">‡¶≤‡ßá‡¶ñ‡¶ï</span> 
                    <span id="read-meta-cat" class="bg-gray-100 px-2 py-0.5 rounded border border-gray-200 text-gray-600">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</span>
                </div>
                <div id="read-meta-views" class="flex items-center gap-1 font-medium bg-gray-50 px-2 py-0.5 rounded">üëÅÔ∏è 0</div>
            </div>
            <div id="read-content" class="text-gray-800 leading-relaxed whitespace-pre-wrap font-medium select-none" style="font-size: 18px;"></div>
            <div class="mt-12 pt-6 border-t border-gray-100">
                <button onclick="shareStory()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3.5 rounded-xl font-bold shadow-lg flex justify-center items-center gap-2 transition-transform active:scale-95">
                    <span>üîó</span> ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
            </div>
        </div>
    </div>

    <div id="admin-panel" class="hidden min-h-screen bg-gray-50 pb-20">
        <div class="bg-white p-4 shadow-sm flex justify-between items-center sticky top-0 z-20 border-b">
            <h2 class="text-xl font-bold text-gray-800">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
            <div class="flex gap-2">
                <button onclick="showScreen('home-screen')" class="px-4 py-2 bg-gray-200 rounded-lg text-sm text-black hover:bg-gray-300">‡¶π‡ßã‡¶Æ</button>
                <button onclick="auth.signOut().then(() => showScreen('home-screen'))" class="px-4 py-2 bg-red-100 text-red-600 rounded-lg text-sm font-bold hover:bg-red-200">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
        </div>

        <div class="p-4 max-w-4xl mx-auto space-y-6">
            <div class="bg-white p-5 rounded-xl shadow-sm border">
                <h3 class="font-bold text-lg mb-4 text-gray-800 border-b pb-2">‚öôÔ∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
                <div class="grid gap-4 md:grid-cols-2">
                    <input id="set-app-name" type="text" placeholder="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ" class="p-2 border rounded text-black">
                    <input id="set-ad-link" type="text" placeholder="Monetag Direct Link (URL)" class="p-2 border rounded text-black">
                </div>
                <button onclick="updateSettings()" class="mt-4 bg-gray-800 text-white px-6 py-2 rounded-lg text-sm hover:bg-gray-900">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-sm border">
                <h3 class="font-bold text-lg mb-4 text-gray-800 border-b pb-2">üìÇ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3>
                <div class="flex gap-2 mb-4">
                    <input id="new-cat-input" type="text" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶®‡¶æ‡¶Æ" class="flex-1 p-2 border rounded text-black focus:outline-none focus:border-blue-500">
                    <button onclick="addCategory()" class="bg-green-600 text-white px-4 rounded font-bold hover:bg-green-700 active:bg-green-800">+</button>
                </div>
                <div id="admin-cat-list" class="flex flex-wrap gap-2"></div>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-sm border">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 id="form-mode-title" class="font-bold text-lg text-gray-800">üìù ‡¶ó‡¶≤‡ßç‡¶™ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</h3>
                    <button onclick="resetForm()" class="text-xs text-blue-600 underline hover:text-blue-800">‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
                </div>
                <form id="story-form" class="space-y-4">
                    <input type="hidden" id="edit-id">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input id="story-title" required type="text" placeholder="‡¶ó‡¶≤‡ßç‡¶™‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ" class="p-3 border rounded text-black w-full outline-none">
                        <input id="story-author" required type="text" placeholder="‡¶≤‡ßá‡¶ñ‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ" class="p-3 border rounded text-black w-full outline-none">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <select id="story-category-select" class="p-3 border rounded bg-white text-black w-full"></select>
                        <select id="story-status" class="p-3 border rounded bg-white text-black w-full">
                            <option value="Published">Published</option>
                            <option value="Draft">Draft</option>
                        </select>
                    </div>
                    <textarea id="story-summary" rows="2" placeholder="‡¶õ‡ßã‡¶ü ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™" class="w-full p-3 border rounded text-black outline-none"></textarea>
                    <textarea id="story-content" required rows="10" placeholder="‡¶Æ‡ßÇ‡¶≤ ‡¶ó‡¶≤‡ßç‡¶™..." class="w-full p-3 border rounded text-black outline-none"></textarea>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </form>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-sm border">
                <h3 class="font-bold text-lg mb-4 text-gray-800 border-b pb-2">‡¶∏‡¶¨ ‡¶ó‡¶≤‡ßç‡¶™‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                <div id="admin-story-list" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_EMAIL = "bcg332006@gmail.com";
        const DEFAULT_CATS = ['‡¶∞‡ßã‡¶Æ‡¶æ‡¶®‡ßç‡¶ü‡¶ø‡¶ï', '‡¶™‡¶∞‡¶ï‡ßÄ‡ßü‡¶æ', '‡¶á‡¶®‡¶∏‡ßá‡¶∏‡ßç‡¶ü', '‡¶≠‡¶æ‡¶¨‡¶ø', '‡¶≤‡ßá‡¶∏‡¶¨‡¶ø‡ßü‡¶æ‡¶®', '‡¶´‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶ü‡¶æ‡¶∏‡¶ø', '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø', '‡¶Æ‡¶æ ‡¶õ‡ßá‡¶≤‡ßá'];

        const firebaseConfig = {
            apiKey: "AIzaSyA4gqOdRYydzPOR7a8brxBy2Bs49MtVqJw",
            authDomain: "bangla-f8386.firebaseapp.com",
            projectId: "bangla-f8386",
            storageBucket: "bangla-f8386.firebasestorage.app",
            messagingSenderId: "213257434534",
            appId: "1:213257434534:web:3748a963d1f4e299e64b67"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.firestore();
        const auth = firebase.auth();

        let appSettings = { name: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ö‡¶ü‡¶ø ‡¶ó‡¶≤‡ßç‡¶™", adLink: "https://google.com" };
        let categories = [...DEFAULT_CATS]; 
        let stories = [];
        let currentUser = null;
        let currentFontSize = 18; 
        let currentStoryId = null; 
        let initialUrlCheckDone = false; 
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentFilteredList = [];
        let isSignUpMode = false;

        document.addEventListener('DOMContentLoaded', init);

        function init() {
            if(!localStorage.getItem('age_verified')) {
                document.getElementById('age-gate').classList.remove('hidden');
            }

            if(localStorage.getItem('nightMode') === 'true') {
                document.body.classList.add('night-mode');
            }

            auth.onAuthStateChanged(user => {
                currentUser = user;
                const authModal = document.getElementById('auth-modal');
                const adminBtn = document.getElementById('admin-indicator');

                if(user) {
                    authModal.classList.add('hidden');
                    if(user.email === ADMIN_EMAIL) {
                        adminBtn.classList.remove('hidden');
                    } else {
                        adminBtn.classList.add('hidden');
                        if(!document.getElementById('admin-panel').classList.contains('hidden')) showScreen('home-screen');
                    }
                } else {
                    authModal.classList.remove('hidden');
                    adminBtn.classList.add('hidden');
                }
            });

            db.collection('config').doc('app_settings').onSnapshot(doc => {
                if(doc.exists) { appSettings = doc.data(); updateAppMeta(); }
                removeLoader();
            }, err => removeLoader());

            db.collection('config').doc('categories').onSnapshot(doc => {
                if(doc.exists && doc.data().list) categories = doc.data().list;
                renderCategoriesUI();
            });

            db.collection('stories').orderBy('updatedAt', 'desc').onSnapshot(snap => {
                stories = snap.docs.map(d => ({id: d.id, ...d.data()}));
                applyFilters(); 
                if(currentUser && currentUser.email === ADMIN_EMAIL) renderAdminListUI();
                if (!initialUrlCheckDone && stories.length > 0) {
                    const params = new URLSearchParams(window.location.search);
                    const sharedId = params.get('id') || params.get('startapp');
                    if(sharedId && stories.find(s => s.id === sharedId)) openStory(sharedId);
                    initialUrlCheckDone = true;
                }
            });
        }

        function toggleAuthMode() {
            isSignUpMode = !isSignUpMode;
            document.getElementById('auth-title').innerText = isSignUpMode ? "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü" : "‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById('auth-subtitle').innerText = isSignUpMode ? "‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶á‡¶®-‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®" : "‡¶ó‡¶≤‡ßç‡¶™ ‡¶™‡ßú‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById('auth-submit-btn').innerText = isSignUpMode ? "‡¶∏‡¶æ‡¶á‡¶®-‡¶Ü‡¶™" : "‡¶≤‡¶ó‡¶á‡¶®";
            document.getElementById('auth-toggle-link').innerText = isSignUpMode ? "‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®" : "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®";
        }

        async function handleAuth(e) {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            const btn = document.getElementById('auth-submit-btn');
            btn.disabled = true;
            btn.innerText = "‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...";

            try {
                if (isSignUpMode) {
                    await auth.createUserWithEmailAndPassword(email, pass);
                    alert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                } else {
                    await auth.signInWithEmailAndPassword(email, pass);
                }
            } catch(err) {
                alert("‡¶≠‡ßÅ‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá: " + err.message);
            } finally {
                btn.disabled = false;
                btn.innerText = isSignUpMode ? "‡¶∏‡¶æ‡¶á‡¶®-‡¶Ü‡¶™" : "‡¶≤‡¶ó‡¶á‡¶®";
            }
        }

        function removeLoader() { document.getElementById('loading-screen')?.classList.add('hidden'); }

        function updateAppMeta() {
            document.getElementById('app-title-tag').innerText = appSettings.name;
            document.getElementById('app-nav-title').innerText = appSettings.name;
            document.getElementById('set-app-name').value = appSettings.name || "";
            document.getElementById('set-ad-link').value = appSettings.adLink || "";
        }

        function triggerDirectLinkAd() {
            if(appSettings.adLink?.startsWith('http')) window.open(appSettings.adLink, '_blank');
        }

        function acceptAgeGate() {
            localStorage.setItem('age_verified', 'true');
            document.getElementById('age-gate').classList.add('hidden');
        }

        function getFavorites() { return JSON.parse(localStorage.getItem('favStories')) || []; }

        function toggleFavorite(e, id) {
            e.stopPropagation(); 
            let favs = getFavorites();
            favs = favs.includes(id) ? favs.filter(f => f !== id) : [...favs, id];
            localStorage.setItem('favStories', JSON.stringify(favs));
            applyFilters();
        }

        function toggleReadScreenFavorite() {
            if(!currentStoryId) return;
            let favs = getFavorites();
            favs = favs.includes(currentStoryId) ? favs.filter(f => f !== currentStoryId) : [...favs, currentStoryId];
            localStorage.setItem('favStories', JSON.stringify(favs));
            document.getElementById('read-fav-btn').innerText = favs.includes(currentStoryId) ? '‚ù§Ô∏è' : 'ü§ç';
        }

        function applyFilters(categoryOverride = null) {
            let searchQuery = document.getElementById('search-input').value.trim().toLowerCase();
            const activeCatBtn = document.querySelector('#category-filters .bg-blue-600');
            const activeFavBtn = document.querySelector('#category-filters .bg-pink-600');

            let cat = categoryOverride || (activeFavBtn ? 'FAVORITES' : (activeCatBtn ? activeCatBtn.innerText : 'ALL'));
            let filtered = stories.filter(s => s.status === 'Published');

            if(cat === 'FAVORITES') filtered = filtered.filter(s => getFavorites().includes(s.id));
            else if (cat !== 'ALL' && cat !== '‡¶∏‡¶¨') filtered = filtered.filter(s => s.category === cat);

            if(searchQuery) filtered = filtered.filter(s => s.title?.toLowerCase().includes(searchQuery) || s.author?.toLowerCase().includes(searchQuery));

            currentFilteredList = filtered;
            renderPaginatedList();
        }

        function handleSearch() { currentPage = 1; applyFilters(); }

        function filterByCat(cat) {
            currentPage = 1; 
            document.querySelectorAll('#category-filters button').forEach(b => b.className = "px-5 py-1.5 bg-white text-gray-800 border rounded-full text-sm whitespace-nowrap shadow-sm hover:bg-gray-50 transition");
            if(event?.target) event.target.className = cat === 'FAVORITES' ? "px-5 py-1.5 bg-pink-600 text-white border rounded-full text-sm whitespace-nowrap shadow-sm font-bold transition" : "px-5 py-1.5 bg-blue-600 text-white border rounded-full text-sm whitespace-nowrap shadow-sm font-bold transition";
            applyFilters(cat);
        }

        function changePage(page) {
            const totalPages = Math.ceil(currentFilteredList.length / itemsPerPage);
            if(page < 1 || page > totalPages) return;
            triggerDirectLinkAd();
            currentPage = page;
            renderPaginatedList();
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function renderPaginatedList() {
            const list = document.getElementById('stories-list');
            const noData = document.getElementById('no-data-msg');
            if(currentFilteredList.length === 0) {
                list.innerHTML = ''; noData.classList.remove('hidden');
                document.getElementById('pagination-container').innerHTML = ''; return;
            }
            noData.classList.add('hidden');
            const pageData = currentFilteredList.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);
            const favs = getFavorites();
            list.innerHTML = pageData.map(s => `
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 card active:scale-[0.98] transition-transform cursor-pointer relative" onclick="openStory('${s.id}')">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-[10px] font-bold text-white bg-blue-500 px-2 py-0.5 rounded-full">${s.category || '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø'}</span>
                        <div class="flex items-center gap-3">
                            <span class="text-[10px] text-gray-400">üëÅÔ∏è ${s.views || 0}</span>
                            <button onclick="toggleFavorite(event, '${s.id}')" class="text-xl">${favs.includes(s.id) ? '‚ù§Ô∏è' : 'ü§ç'}</button>
                        </div>
                    </div>
                    <h3 class="font-bold text-lg leading-tight mb-2 text-gray-800">${s.title}</h3>
                    <p class="text-gray-500 text-sm line-clamp-2">${s.summary || '‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶™‡ßú‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®...'}</p>
                </div>
            `).join('');
            renderPaginationUI();
        }

        function renderPaginationUI() {
            const container = document.getElementById('pagination-container');
            const totalPages = Math.ceil(currentFilteredList.length / itemsPerPage);
            if(totalPages <= 1) { container.innerHTML = ''; return; }
            let html = `<button onclick="changePage(${currentPage - 1})" class="page-btn inactive" ${currentPage === 1 ? 'disabled' : ''}>‚Üê</button>`;
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) html += `<button onclick="changePage(${i})" class="page-btn ${i === currentPage ? 'active' : 'inactive'}">${i}</button>`;
                else if (i === currentPage - 2 || i === currentPage + 2) html += `<span class="px-1 text-gray-400">...</span>`;
            }
            html += `<button onclick="changePage(${currentPage + 1})" class="page-btn inactive" ${currentPage === totalPages ? 'disabled' : ''}>‚Üí</button>`;
            container.innerHTML = html;
        }

        function renderCategoriesUI() {
            document.getElementById('category-filters').innerHTML = `
                <button onclick="filterByCat('ALL')" class="px-5 py-1.5 bg-blue-600 text-white border rounded-full text-sm font-bold shadow-sm transition">‡¶∏‡¶¨</button>
                <button onclick="filterByCat('FAVORITES')" class="px-5 py-1.5 bg-white text-pink-600 border rounded-full text-sm shadow-sm transition">‚ù§Ô∏è ‡¶´‡ßá‡¶≠‡¶æ‡¶∞‡¶ø‡¶ü</button>
                ${categories.map(c => `<button onclick="filterByCat('${c}')" class="px-5 py-1.5 bg-white text-gray-800 border rounded-full text-sm shadow-sm transition">${c}</button>`).join('')}
            `;
            document.getElementById('story-category-select').innerHTML = categories.map(c => `<option value="${c}">${c}</option>`).join('');
            const adminCatList = document.getElementById('admin-cat-list');
            if(adminCatList) adminCatList.innerHTML = categories.map(c => `<span class="bg-gray-100 border px-3 py-1 rounded-full text-xs flex items-center gap-2 text-black mr-1 mb-1">${c} <button onclick="deleteCategory('${c}')" class="text-red-500 font-bold">√ó</button></span>`).join('');
        }

        function openStory(id) {
            const s = stories.find(x => x.id === id);
            if(!s) return;
            if (typeof show_10366901 === 'function') show_10366901('pop'); else triggerDirectLinkAd();
            currentStoryId = id; 
            window.history.pushState({}, '', '?id=' + id);
            if(!currentUser || currentUser.email !== ADMIN_EMAIL) db.collection('stories').doc(id).update({ views: firebase.firestore.FieldValue.increment(1) });
            document.getElementById('read-title').innerText = s.title;
            document.getElementById('read-meta-author').innerText = `‡¶≤‡ßá‡¶ñ‡¶ï: ${s.author}`;
            document.getElementById('read-meta-cat').innerText = s.category;
            document.getElementById('read-meta-views').innerText = `üëÅÔ∏è ${s.views ? s.views + 1 : 1}`;
            document.getElementById('read-fav-btn').innerText = getFavorites().includes(id) ? '‚ù§Ô∏è' : 'ü§ç';
            const contentEl = document.getElementById('read-content');
            const splitIdx = s.content.indexOf('\n', Math.floor(s.content.length / 2));
            contentEl.innerHTML = `<div>${s.content.substring(0, splitIdx)}</div>` + (appSettings.adLink ? `<div class="my-8 text-center"><a href="${appSettings.adLink}" target="_blank" class="bg-red-600 text-white px-6 py-3 rounded-full font-bold animate-pulse inline-block">üîû ‡ßß‡ßÆ+ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</a></div>` : "") + `<div>${s.content.substring(splitIdx)}</div>`;
            showScreen('reading-screen');
        }

        function closeReadingScreen() { showScreen('home-screen'); currentStoryId = null; window.history.pushState({}, '', window.location.pathname); }

        function changeFontSize(action) {
            currentFontSize = action === 'increase' ? Math.min(currentFontSize + 2, 34) : Math.max(currentFontSize - 2, 12);
            const el = document.getElementById('read-content');
            el.style.fontSize = currentFontSize + 'px'; el.style.lineHeight = (currentFontSize + 12) + 'px';
        }

        function shareStory() {
            const text = `üî• ‡¶ó‡¶≤‡ßç‡¶™: "${document.getElementById('read-title').innerText}"\n‡¶™‡ßú‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®: ${window.location.href}`;
            if (navigator.share) navigator.share({title: '‡¶ó‡¶≤‡ßç‡¶™', text}).catch(() => {});
            else { navigator.clipboard.writeText(text); alert("‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
        }

        async function updateSettings() {
            const name = document.getElementById('set-app-name').value;
            const link = document.getElementById('set-ad-link').value;
            await db.collection('config').doc('app_settings').set({ name, adLink: link }, { merge: true });
            alert("‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        }

        async function addCategory() {
            const val = document.getElementById('new-cat-input').value.trim();
            if(val && !categories.includes(val)) {
                await db.collection('config').doc('categories').set({ list: [...categories, val] });
                document.getElementById('new-cat-input').value = "";
            }
        }

        async function deleteCategory(cat) {
            if(confirm("‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?")) await db.collection('config').doc('categories').set({ list: categories.filter(c => c !== cat) });
        }

        document.getElementById('story-form').onsubmit = async (e) => {
            e.preventDefault();
            const id = document.getElementById('edit-id').value;
            const data = {
                title: document.getElementById('story-title').value,
                author: document.getElementById('story-author').value,
                category: document.getElementById('story-category-select').value,
                summary: document.getElementById('story-summary').value,
                content: document.getElementById('story-content').value,
                status: document.getElementById('story-status').value,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            if(!id) data.views = 0;
            id ? await db.collection('stories').doc(id).update(data) : await db.collection('stories').add(data);
            resetForm(); alert("‡¶∏‡¶´‡¶≤!");
        };

        function resetForm() { document.getElementById('story-form').reset(); document.getElementById('edit-id').value = ""; document.getElementById('form-mode-title').innerText = "‡¶ó‡¶≤‡ßç‡¶™ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"; }

        function editStory(id) {
            const s = stories.find(x => x.id === id);
            document.getElementById('edit-id').value = s.id;
            document.getElementById('story-title').value = s.title;
            document.getElementById('story-author').value = s.author;
            document.getElementById('story-category-select').value = s.category;
            document.getElementById('story-content').value = s.content;
            document.getElementById('story-status').value = s.status;
            document.getElementById('form-mode-title').innerText = "‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡ßã‡¶°";
        }

        async function deleteStory(id) { if(confirm("‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?")) await db.collection('stories').doc(id).delete(); }

        function showScreen(id) {
            ['home-screen', 'reading-screen', 'admin-panel'].forEach(s => document.getElementById(s)?.classList.add('hidden'));
            document.getElementById(id)?.classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function renderAdminListUI() {
            document.getElementById('admin-story-list').innerHTML = stories.map(s => `
                <div class="flex justify-between items-center bg-gray-50 p-3 rounded border">
                    <div><h4 class="font-bold text-sm text-gray-800">${s.title}</h4><span class="text-xs text-gray-500">${s.status}</span></div>
                    <div class="flex gap-2">
                        <button onclick="editStory('${s.id}')" class="text-blue-600 text-sm">Edit</button>
                        <button onclick="deleteStory('${s.id}')" class="text-red-600 text-sm">Delete</button>
                    </div>
                </div>`).join('');
        }

        function toggleNightMode() { document.body.classList.toggle('night-mode'); localStorage.setItem('nightMode', document.body.classList.contains('night-mode')); }
    </script>
</body>
</html>
